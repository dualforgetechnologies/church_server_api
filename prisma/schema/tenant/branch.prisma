model Branch {
  id             String     @id @default(cuid())
  tenantId       String
  parentBranchId String? // For hierarchical branches
  name           String
  code           String     @unique // Unique across system
  slug           String     @unique // URL friendly
  description    String?
  type           BranchType @default(BRANCH)

  // Contact
  email    String?
  phone    String?
  address  String?
  city     String?
  state    String?
  country  String?
  timezone String?

  // Management
  pastorId  String?      @unique
  status    BranchStatus @default(ACTIVE)
  isPrimary Boolean      @default(false)

  // Capacity
  maxCapacity     Int?
  seatingCapacity Int?
  parkingCapacity Int?

  // Audit
  createdBy   String?
  updatedBy   String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  isDeleted   Boolean   @default(false)
  deletedById String?
  deletedAt   DateTime?

  // Relations
  tenant   Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  pastor   Member?  @relation("BranchPastor", fields: [pastorId], references: [id], onDelete: SetNull)
  parent   Branch?  @relation("BranchHierarchy", fields: [parentBranchId], references: [id])
  children Branch[] @relation("BranchHierarchy")
  members  Member[] @relation("BranchMembers")

  BranchMembers MemberBranchAssignment[]
  departments   Department[]
  Community     Community[]
  User          User?                    @relation(fields: [userId], references: [id])
  userId        String?

  @@unique([tenantId, code])
  @@unique([tenantId, slug])
  @@index([tenantId])
  @@index([parentBranchId])
  @@index([status])
  @@map("branches")
}

enum BranchType {
  MAIN
  BRANCH
  SATELLITE
  CAMPUS
  PLANT
}

enum BranchStatus {
  ACTIVE
  INACTIVE
  CLOSED
  MERGED
  PLANNING
}

model MemberBranchAssignment {
  id             String           @id @default(cuid())
  memberId       String
  branchId       String
  assignmentDate DateTime         @default(now())
  status         AssignmentStatus @default(ACTIVE)

  // Relations
  member Member @relation(fields: [memberId], references: [id], onDelete: Cascade)
  branch Branch @relation(fields: [branchId], references: [id], onDelete: Cascade)

  @@unique([memberId, branchId])
  @@index([memberId])
  @@index([branchId])
  @@index([status])
  @@map("member_branch_assignments")
}
