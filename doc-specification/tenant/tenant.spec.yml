paths:
  /api/v1/tenants:
    post:
      tags: [Tenants]
      summary: Create a new tenant
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTenantDto'
      responses:
        '201':
          description: Tenant created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TenantResponse'
        '400': { description: Validation error }
        '401': { description: Unauthorized }
        '409': { description: Tenant with email/name/slug already exists }

    get:
      tags: [Tenants]
      summary: List tenants with optional filters, pagination, and sorting
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          schema: { type: integer, default: 1 }
        - name: limit
          in: query
          schema: { type: integer, default: 20 }
        - name: status
          in: query
          schema: { $ref: '#/components/schemas/TenantStatus' }
        - name: subscriptionTier
          in: query
          schema: { $ref: '#/components/schemas/SubscriptionTier' }
        - name: country
          in: query
          schema: { type: string }
        - name: email
          in: query
          schema: { type: string }
        - name: sortBy
          in: query
          schema:
            type: string
            enum: [createdAt, updatedAt, name, email]
            default: createdAt
        - name: sortOrder
          in: query
          schema:
            type: string
            enum: [asc, desc]
            default: desc
      responses:
        '200':
          description: List of tenants
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/TenantResponse'
                  pagination:
                    $ref: '#/components/schemas/PaginatedMetaData'
        '401': { description: Unauthorized }

  /api/v1/tenants/trial:
    post:
      tags: [Tenants]
      summary: Create a trial tenant (FREE tier)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTrialTenantDto'
      responses:
        '201':
          description: Trial tenant created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TenantResponse'
        '400': { description: Validation error }
        '409': { description: Tenant with email already exists }

  /api/v1/tenants/{id}:
    get:
      tags: [Tenants]
      summary: Get tenant by ID
      security: [{ bearerAuth: [] }]
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses:
        '200':
          description: Tenant found
          content:
            application/json:
              schema: { $ref: '#/components/schemas/TenantResponse' }
        '401': { description: Unauthorized }
        '404': { description: Tenant not found }

    put:
      tags: [Tenants]
      summary: Update tenant details
      security: [{ bearerAuth: [] }]
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTenantDto'
      responses:
        '200':
          description: Tenant updated successfully
          content:
            application/json:
              schema: { $ref: '#/components/schemas/TenantResponse' }
        '400': { description: Validation error }
        '401': { description: Unauthorized }
        '404': { description: Tenant not found }

    delete:
      tags: [Tenants]
      summary: Soft delete tenant
      security: [{ bearerAuth: [] }]
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      responses:
        '200': { description: Tenant deleted successfully }
        '401': { description: Unauthorized }
        '404': { description: Tenant not found }

  /api/v1/tenants/{id}/subscription:
    put:
      tags: [Tenants]
      summary: Update tenant subscription
      security: [{ bearerAuth: [] }]
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTenantSubscriptionDto'
      responses:
        '200': { description: Tenant subscription updated successfully }
        '401': { description: Unauthorized }

    post:
      tags: [Tenants]
      summary: Extend tenant subscription
      security: [{ bearerAuth: [] }]
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ExtendTenantSubscriptionDto'
      responses:
        '200': { description: Tenant subscription extended successfully }
        '401': { description: Unauthorized }

  /api/v1/tenants/{id}/status:
    put:
      tags: [Tenants]
      summary: Update tenant status
      security: [{ bearerAuth: [] }]
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTenantStatusDto'
      responses:
        '200': { description: Tenant status updated successfully }
        '401': { description: Unauthorized }

  /api/v1/tenants/{id}/suspend:
    post:
      tags: [Tenants]
      summary: Suspend a tenant
      security: [{ bearerAuth: [] }]
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SuspendTenantDto'
      responses:
        '200': { description: Tenant suspended successfully }
        '401': { description: Unauthorized }

  /api/v1/tenants/{id}/reactivate:
    post:
      tags: [Tenants]
      summary: Reactivate a tenant
      security: [{ bearerAuth: [] }]
      parameters:
        - name: id
          in: path
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReactivateTenantDto'
      responses:
        '200': { description: Tenant reactivated successfully }
        '401': { description: Unauthorized }

/api/v1/tenants/with-admin:
  post:
    tags: [Tenants]
    summary: Create tenant with admin user
    description: >
      Creates a new tenant and assigns a tenant administrator in a single transaction.
      Admin role is enforced as TENANT_ADMIN.
    security:
      - bearerAuth: []
    requestBody:
      required: true
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/CreateTenantWithAdminDto'
    responses:
      '201':
        description: Tenant and admin created successfully
        content:
          application/json:
            schema:
              type: object
              properties:
                tenant:
                  $ref: '#/components/schemas/TenantResponse'
                tenantAdmin:
                  $ref: '#/components/schemas/UserResponse'
      '400':
        description: Validation error
      '401':
        description: Unauthorized
      '409':
        description: Tenant or admin already exists


components:
  schemas:
    TenantStatus:
      type: string
      enum: [ACTIVE, INACTIVE, SUSPENDED, PENDING, TRIAL]

    SubscriptionTier:
      type: string
      enum: [FREE, BASIC, PRO, PREMIUM, ENTERPRISE]

    CreateTenantDto:
      type: object
      required: [name, slug, email]
      properties:
        name: { type: string }
        slug: { type: string }
        email: { type: string, format: email }
        phone: { type: string, nullable: true }
        logo: { type: string, format: uri, nullable: true }
        description: { type: string, nullable: true }
        address: { type: string, nullable: true }
        city: { type: string, nullable: true }
        state: { type: string, nullable: true }
        country: { type: string, default: US }
        timezone: { type: string, default: UTC }
        language: { type: string, default: en }
        currencyId: { type: string, nullable: true }
        defaultCurrency: { type: string, default: USD }
        subscriptionTier: { $ref: '#/components/schemas/SubscriptionTier', default: BASIC }
        subscriptionExpiresAt: { type: string, format: date-time, nullable: true }
        isBranchEnabled: { type: boolean, default: true }
        status: { $ref: '#/components/schemas/TenantStatus', default: PENDING }

    CreateTrialTenantDto:
      allOf:
        - $ref: '#/components/schemas/CreateTenantDto'
        - type: object
          properties:
            subscriptionTier: { $ref: '#/components/schemas/SubscriptionTier', enum: [FREE] }
            status: { $ref: '#/components/schemas/TenantStatus', enum: [TRIAL] }
            subscriptionExpiresAt: { type: string, format: date-time }

    UpdateTenantDto:
      type: object
      properties:
        name: { type: string }
        slug: { type: string }
        email: { type: string, format: email }
        phone: { type: string }
        logo: { type: string, format: uri }
        description: { type: string }
        address: { type: string }
        city: { type: string }
        state: { type: string }
        country: { type: string }
        timezone: { type: string }
        language: { type: string }
        currencyId: { type: string }
        defaultCurrency: { type: string }
        isBranchEnabled: { type: boolean }

    UpdateTenantSubscriptionDto:
      type: object
      properties:
        subscriptionTier: { $ref: '#/components/schemas/SubscriptionTier' }
        subscriptionExpiresAt: { type: string, format: date-time }

    ExtendTenantSubscriptionDto:
      type: object
      required: [subscriptionExpiresAt]
      properties:
        subscriptionExpiresAt: { type: string, format: date-time }

    UpdateTenantStatusDto:
      type: object
      required: [status]
      properties:
        status: { $ref: '#/components/schemas/TenantStatus' }

    SuspendTenantDto:
      type: object
      required: [reason]
      properties:
        reason: { type: string }

    ReactivateTenantDto:
      type: object
      required: [status]
      properties:
        status: { $ref: '#/components/schemas/TenantStatus', enum: [ACTIVE] }

    TenantResponse:
      type: object
      properties:
        id: { type: string }
        name: { type: string }
        slug: { type: string }
        email: { type: string }
        phone: { type: string, nullable: true }
        logo: { type: string, nullable: true }
        description: { type: string, nullable: true }
        address: { type: string, nullable: true }
        city: { type: string, nullable: true }
        state: { type: string, nullable: true }
        country: { type: string }
        timezone: { type: string }
        language: { type: string }
        currencyId: { type: string, nullable: true }
        defaultCurrency: { type: string }
        subscriptionTier: { $ref: '#/components/schemas/SubscriptionTier' }
        subscriptionExpiresAt: { type: string, format: date-time, nullable: true }
        isBranchEnabled: { type: boolean }
        status: { $ref: '#/components/schemas/TenantStatus' }
        createdAt: { type: string, format: date-time }
        updatedAt: { type: string, format: date-time }

    PaginatedMetaData:
      type: object
      properties:
        page: { type: integer, example: 1 }
        limit: { type: integer, example: 20 }
        total: { type: integer, example: 120 }
        totalPages: { type: integer, example: 6 }

    AppResponse:
      type: object
      required: [message, code, success]
      properties:
        message: { type: string, example: Operation successful }
        code: { type: integer, example: 200 }
        success: { type: boolean, example: true }
        data: { nullable: true }
        pagination: { $ref: '#/components/schemas/PaginatedMetaData', nullable: true }
        environment: { type: string, example: production }
    CreateTenantWithAdminDto:
      type: object
      required:
        - tenantData
        - adminData
      properties:
        tenantData:
          $ref: '#/components/schemas/CreateTenantDto'
        adminData:
          $ref: '#/components/schemas/CreateUserDto'
    ErrorResponse:
      allOf:
        - $ref: '#/components/schemas/AppResponse'
        - type: object
          properties:
            success: { example: false }
            data: { nullable: true }
